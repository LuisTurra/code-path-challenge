<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Path Challenge</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body>

    <!-- Controls -->
    <div id="top-controls">
        <button id="home-btn" onclick="showStartScreen()" title="Home">
            <i class="fas fa-home"></i>
        </button>
        <button id="tutorial-btn" onclick="toggleTutorial()" title="How to Play">
            <i class="fas fa-question"></i>
        </button>
    </div>

    <div id="tutorial-modal" class="modal">
                <div class="modal-content">
                                    <span class="close" onclick="closeTutorial()">&times;</span>
                        <h3>How to Play</h3>
                        <p>Click direction buttons to build a command sequence. Cube must stay on <strong>white
                    path</strong> and
                                reach <strong>B (red)</strong>. Hit "Start" to run!<br><br>Forward/back OK, but
                <strong>no leaving
                                        path</strong>!
            </p>
                                    <button onclick="closeTutorial()" class="green-btn" style="margin-top: 15px;">Got
                It!</button>
                    </div>
            </div>

    <!-- Start Screen  -->
    <div id="start-screen" class="screen active">
        <div id="start-background"></div>
        <h1>Code Path Challenge</h1>
        <p>Guide the cube from A to B using direction commands!</p>

        <!-- Menu Buttons  -->
        <div id="start-menu-buttons" class="menu-buttons-stack">
            <button onclick="startPhase(1)" class="menu-btn green-btn">▶ Start (Phase 1)</button>
            <button onclick="showPhaseSelection()" class="menu-btn green-btn">Phases</button>
            <button onclick="showGlobalRankings()" class="menu-btn green-btn">Rankings</button>
        </div>
    </div>

    <!-- Phase Selection Modal -->
    <div id="phase-selection-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePhaseSelection()">&times;</span>
            <h2>Select Phase</h2>
            <div id="phase-selection-buttons">

            </div>
            <button onclick="showStartScreen()" class="green-btn">Back to Menu</button>
        </div>
    </div>
    <!-- Entry Name -->

    <div id="name-entry-modal">
        <div class="name-wrapper">
            <div class="name-content">
                <h3>Phase <span id="name-phase-num"></span> Completed!</h3>

                <div id="name-stats" style="margin: 20px 0; font-size: 1.3em; line-height: 1.6;">

                </div>

                <div style="margin: 25px 0;">
                    <input type="text" id="player-name-input" placeholder="Enter your name" maxlength="15"
                        autocomplete="off" style="width: 100%; padding: 16px; font-size: 1.2em; 
                      border: 2px solid #00ff88; border-radius: 12px; 
                      background: rgba(0,0,0,0.4); color: white; 
                      text-align: center; outline: none;
                      box-shadow: 0 0 20px rgba(0,255,136,0.3);">
                </div>

                <div class="name-buttons">
                    <button onclick="submitPlayerName()" class="green-btn">Submit to Leaderboard</button>
                    <button onclick="closeNameModal()" class="green-btn"
                        style="background: #444; border: 2px solid #666;">
                        Skip
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Game Screen -->
    <div id="game-screen" class="screen">
        <div id="phase-nav">
            <button id="phase-1-btn" class="phase-btn active" onclick="startPhase(1)">Phase 1</button>
            <button id="phase-2-btn" class="phase-btn locked" onclick="startPhase(2)">Phase 2
                <span>LOCKED</span></button>
            <button id="phase-3-btn" class="phase-btn locked" onclick="startPhase(3)">Phase 3
                <span>LOCKED</span></button>
            <button id="phase-4-btn" class="phase-btn locked" onclick="startPhase(4)">Phase 4
                <span>LOCKED</span></button>
            <button id="phase-5-btn" class="phase-btn locked" onclick="startPhase(5)">Phase 5
                <span>LOCKED</span></button>
            <button id="phase-6-btn" class="phase-btn locked" onclick="startPhase(6)">Phase 6
                <span>LOCKED</span></button>
            <button id="phase-7-btn" class="phase-btn locked" onclick="startPhase(7)">Phase 7
                <span>LOCKED</span></button>
        </div>

        <div id="game-row">
            <!-- Grid -->
            <div class="grid-outer">
                <div class="grid-inner">
                    <div id="game-container">
                        <div id="grid"></div>
                        <div id="cube"></div>
                        <div id="start-point" class="point">A</div>
                        <div id="end-point" class="point">B</div>
                    </div>
                </div>
            </div>

            <!-- Controls Panel -->
            <div id="controls-panel">
                <div id="controls">

                    <div class="dir-row"><button onclick="addCommand('up')" class="dir-btn"><i
                                class="fas fa-arrow-up"></i></button></div>
                    <div class="dir-row">
                        <button onclick="addCommand('left')" class="dir-btn"><i class="fas fa-arrow-left"></i></button>
                        <button onclick="addCommand('right')" class="dir-btn"><i
                                class="fas fa-arrow-right"></i></button>
                    </div>
                    <div class="dir-row"><button onclick="addCommand('down')" class="dir-btn"><i
                                class="fas fa-arrow-down"></i></button></div>

                    <!-- Action buttons -->
                    <div class="action-row">
                        <button onclick="startGame()" id="start-btn">Start</button>
                        <button onclick="resetGame()">Reset</button>
                    </div>

                    <div class="action-row" style="justify-content:center;">
                        <button onclick="addFunctionCommand()" id="function-btn" style="display:none;">F1</button>
                    </div>
                    <div class="action-row" style="justify-content:center;">
                        <button onclick="addFunction2Command()" id="function2-btn" style="display:none;">F2</button>
                    </div>
                </div>

                <!-- Function Box -->


            </div>
            <div id="function-box" style="display:none;">
                <div style="color:#ffaa00;font-weight:bold;margin-bottom:8px;">
                    FUNCTION (F1):
                    <button onclick="clearFunction()"
                        style="float:right;background:#cc0000;color:#fff;border:none;padding:4px 8px;font-size:12px;border-radius:6px;cursor:pointer;">Clear</button>
                </div>
                <div id="func-limit-text">
                    You have only <span id="func-limit-number">4</span> function commands
                </div>
                <div id="function-commands"><span style="color:#666">[]</span></div>
                <div style="margin-top:8px;display:flex;justify-content:center;gap:6px;">
                    <button onclick="addToFunction('up')" class="dir-btn small"><i class="fas fa-arrow-up"></i></button>
                    <button onclick="addToFunction('down')" class="dir-btn small"><i
                            class="fas fa-arrow-down"></i></button>
                    <button onclick="addToFunction('left')" class="dir-btn small"><i
                            class="fas fa-arrow-left"></i></button>
                    <button onclick="addToFunction('right')" class="dir-btn small"><i
                            class="fas fa-arrow-right"></i></button>
                    <button onclick="addToFunction('F2')" class="dir-btn small recursive-call-btn"
                        style="background:#ff6600; color:white; font-weight:bold;display:none;">
                        F2
                    </button>
                </div>

            </div>
            <!-- Function 2 Box -->
            <div id="function2-box" style="display:none;">
                <div style="color:#ffaa00;font-weight:bold;margin-bottom:8px;">
                    FUNCTION 2 (F2):
                    <button onclick="clearFunction2()"
                        style="float:right;background:#cc0000;color:#fff;border:none;padding:4px 8px;font-size:12px;border-radius:6px;cursor:pointer;">Clear</button>
                </div>
                <div id="func2-limit-text">
                    You have only <span id="func2-limit-number">4</span> function commands
                </div>
                <div id="function2-commands"><span style="color:#666">[]</span></div>
                <div style="margin-top:8px;display:flex;justify-content:center;gap:6px;">
                    <button onclick="addToFunction2('up')" class="dir-btn small"><i
                            class="fas fa-arrow-up"></i></button>
                    <button onclick="addToFunction2('down')" class="dir-btn small"><i
                            class="fas fa-arrow-down"></i></button>
                    <button onclick="addToFunction2('left')" class="dir-btn small"><i
                            class="fas fa-arrow-left"></i></button>
                    <button onclick="addToFunction2('right')" class="dir-btn small"><i
                            class="fas fa-arrow-right"></i></button>
                    <button onclick="addToFunction2('F')" class="dir-btn small recursive-call-btn"
                        style="background:#ffaa00; color:white; font-weight:bold;display:none;">
                        F1
                    </button>
                </div>
            </div>
        </div>

        <!-- Command limit  -->
        <div id="command-limit-text" style="color:#ffaa00;font-weight:bold;margin:10px 0;display:none;">
            You have only <span id="limit-number">4</span> main commands – use FUNCTION (F) wisely!
        </div>

        <div id="command-list"></div>



        <!-- Result -->
        <!-- RESULT MODAL - PHASE COMPLETE -->
        <div id="result-modal">
            <div class="result-wrapper">
                <div class="result-content">
                    <h3 id="result-title">Phase Complete!</h3>
                    <div id="result-message" style="font-size:1.3em; margin:20px 0; line-height:1.5;"></div>

                    <div class="result-buttons">
                        <button id="next-btn" onclick="nextPhase()" class="green-btn">Next Phase</button>
                        <button onclick="resetGame(); closeModal();" class="green-btn">Play Again</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Button Ranking -->
        <div class="button-container">
            <button onclick="showRanking(currentPhase || 1)" class="green-btn">
                View Ranking – Phase <span id="ranking-phase-num">1</span>
            </button>
            <button onclick="showGlobalRankings()" class="green-btn">
                View Global Rankings
            </button>
        </div>

        <!-- RANKING MODAL (for single phase) -->
        <div id="ranking-modal" class="modal" style="display:none;">
            <div class="modal-content">
                <span class="close" onclick="closeRankingModal()">×</span>
                <div class="scroll-area"> <!-- ← ADD THIS WRAPPER -->
                    <h2 id="ranking-title" style="text-align:center; margin-top:0;">Phase 1 Ranking</h2>
                    <div id="ranking-list"></div>
                </div>
            </div>
        </div>

        <!-- Phase Selection -->
        <!-- <div id="phase-selection-modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closePhaseSelection()">&times;</span>
                <h2>Select Phase</h2>
                <div id="phase-selection-buttons">
                </div>
                <button onclick="closePhaseSelection()" class="green-btn">Back to Menu</button>
            </div>
        </div> -->

        <!-- Firebase -->
        <script type="module">
            // Tenta carregar o config local (só existe na sua máquina)
            try {
                const { firebaseConfig } = await import('./firebase-config.js');
                window.firebaseConfig = firebaseConfig;
            } catch (e) {
                // Se não achar o arquivo local (ex: alguém abriu no GitHub Pages), carrega do Firebase Hosting
                window.firebaseConfig = {
                    apiKey: "chave-falsa-so-pra-nao-dar-erro",
                    // ... o resto pode ficar vazio ou falso
                };
            }
        </script>
        <script type="module">
            // Agora usa o config que foi carregado no window
            firebase.initializeApp(window.firebaseConfig);
            const db = firebase.firestore();
        </script>
        <script src="core.js"></script>
        <script src="phases.js"></script>
</body>

</html>