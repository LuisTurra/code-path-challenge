<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="title">Code Path Challenge</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body>

    <!-- Main Menu Controls -->
    <div id="top-controls">
        <button id="home-btn" onclick="showStartScreen()" title="Home">
            <i class="fas fa-home"></i>
        </button>
        <button id="tutorial-btn" onclick="toggleTutorial()" title="How to Play">
            <i class="fas fa-question"></i>
        </button>
    </div>

    <!-- Tutorial Modal -->
    <div id="tutorial-modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeTutorial()">&times;</span>
                    <h3 data-i18n="how_to_play_title">How to Play</h3>
                <p data-i18n="tutorial_basic_text">Click direction buttons to build a command sequence.
                Cube must stay on <strong>white path</strong> and reach <strong>B (red)</strong>.
                Hit "Start" to run!<br><br>Forward/back OK, but <strong>no leaving path</strong>! </p>
            <button onclick="closeTutorial()" class="green-btn" style="margin-top: 15px;" data-i18n="got_it">Got
                It!</button>
        </div>
    </div>

    <!-- Start Screen  -->
    <div id="start-screen" class="screen active">
        <div id="start-background"></div>
        <h1 data-i18n="title">Code Path Challenge</h1>
        <p data-i18n="subtitle">Guide the cube from A to B using direction commands!</p>

        <!-- Menu Buttons  -->
        <div id="start-menu-buttons" class="menu-buttons-stack">
            <button onclick="startPhase(1)" class="menu-btn green-btn"><span data-i18n="start_game">Start (Phase
                    1)</span></button>
            <button onclick="showPhaseSelection()" class="menu-btn green-btn" data-i18n="phases">phase</button>
            <button onclick="showGlobalRankings()" class="menu-btn green-btn" data-i18n="rankings">Rankings</button>
        </div>

        <!-- Language Selector -->
        <div id="language-selector">
            <label for="language-select">Idioma / Language:</label>
            <select id="language-select">
                <option value="en">English</option>
                <option value="pt">Português (BR)</option>
            </select>
        </div>

        <!-- Ko-fi -->
        <div id="kofi-support">
            <a href="https://ko-fi.com/luisturra" target="_blank" class="kofi-link">
                <img src="https://storage.ko-fi.com/cdn/kofi2.png" alt="Ko-fi">
                <span data-i18n="kofi_button">Apoie no Ko-fi ☕</span>
            </a>
            <p data-i18n="kofi_message">
                Se você gostou do jogo e puder apoiar o desenvolvimento, considere comprar um café virtual! (Totalmente
                opcional ❤️)
            </p>
        </div>
    </div>

    <!-- Phase Selection Modal -->
    <div id="phase-selection-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePhaseSelection()">&times;</span>
            <h2 data-i18n="select_phase">Select Phase</h2>
            <div class="phases-list-scroll">
                <div id="phase-selection-buttons">
                </div>
            </div>
            <button onclick="showStartScreen()" class="green-btn" data-i18n="back_to_menu">Back to Menu</button>
        </div>
    </div>

    <!-- Entry Name -->
    <div id="name-entry-modal">
        <div class="name-wrapper">
            <div class="name-content">
                <h3><span data-i18n="phase">Phase</span> <span id="name-phase-num"></span> <span
                        data-i18n="completed">Completed!</span></h3>
                <div id="name-stats" style="margin: 20px 0; font-size: 1.3em; line-height: 1.6;">
                </div>
                <div style="margin: 25px 0;">
                    <input type="text" id="player-name-input" placeholder="Enter your name" maxlength="15"
                        autocomplete="off" style="width: 100%; padding: 16px; font-size: 1.2em; 
                      border: 2px solid #00ff88; border-radius: 12px; 
                      background: rgba(0,0,0,0.4); color: white; 
                      text-align: center; outline: none;
                      box-shadow: 0 0 20px rgba(0,255,136,0.3);">
                </div>
                <div class="name-buttons">
                    <button onclick="submitPlayerName()" class="green-btn" data-i18n="submit_leaderboard">Submit to
                        Leaderboard</button>
                    <button onclick="closeNameModal()" class="green-btn"
                        style="background: #444; border: 2px solid #666;" data-i18n="skip">
                        Skip
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="game-screen" class="screen">
        <!-- Phases Navigation -->
        <div id="phase-nav">
            <button id="phase-1-btn" class="phase-btn active" onclick="startPhase(1)"><span
                    data-i18n="phase">Phase</span> 1</button>
            <button id="phase-2-btn" class="phase-btn locked" onclick="startPhase(2)"><span
                    data-i18n="phase">Phase</span> 2
                <span class="locked-text" data-i18n="locked">LOCKED</span></button>
            <button id="phase-3-btn" class="phase-btn locked" onclick="startPhase(3)"><span
                    data-i18n="phase">Phase</span> 3
                <span class="locked-text" data-i18n="locked">LOCKED</span></button>
            <button id="phase-4-btn" class="phase-btn locked" onclick="startPhase(4)"><span
                    data-i18n="phase">Phase</span> 4
                <span class="locked-text" data-i18n="locked">LOCKED</span></button>
            <button id="phase-5-btn" class="phase-btn locked" onclick="startPhase(5)"><span
                    data-i18n="phase">Phase</span> 5
                <span class="locked-text" data-i18n="locked">LOCKED</span></button>
            <button id="phase-6-btn" class="phase-btn locked" onclick="startPhase(6)"><span
                    data-i18n="phase">Phase</span> 6
                <span class="locked-text" data-i18n="locked">LOCKED</span></button>
            <button id="phase-7-btn" class="phase-btn locked" onclick="startPhase(7)"><span
                    data-i18n="phase">Phase</span> 7
                <span class="locked-text" data-i18n="locked">LOCKED</span></button>
            <button id="phase-8-btn" class="phase-btn locked" onclick="startPhase(8)"><span
                    data-i18n="phase">Phase</span> 8
                <span class="locked-text" data-i18n="locked">LOCKED</span></button>
            <button id="phase-9-btn" class="phase-btn locked" onclick="startPhase(9)"><span
                    data-i18n="phase">Phase</span> 9
                <span class="locked-text" data-i18n="locked">LOCKED</span></button>
            <button id="phase-10-btn" class="phase-btn locked" onclick="startPhase(10)"><span
                    data-i18n="phase">Phase</span> 10
                <span class="locked-text" data-i18n="locked">LOCKED</span></button>
        </div>

        <!-- Mobile Phase Select -->
        <div class="custom-select-container mobile-only">
            <div id="mobile-phase-display" class="select-selected">
                Selecionar Fase
            </div>
            <ul id="mobile-phase-options" class="select-items select-hide">
            </ul>
        </div>
        <div id="game-row">

            <!-- Grid -->
            <div class="grid-outer">
                <div class="grid-inner">
                    <div id="game-container">
                        <div id="grid"></div>
                        <div id="cube"></div>
                        <div id="start-point" class="point">A</div>
                        <div id="end-point" class="point">B</div>
                    </div>
                </div>
            </div>

            <!-- Controls Panel -->
            <div id="controls-panel">
                <div id="controls">
                    <div class="dir-row"><button onclick="addCommand('up')" class="dir-btn" data-dir="up"><i
                                class="fas fa-arrow-up"></i></button></div>
                    <div class="dir-row">
                        <button onclick="addCommand('left')" class="dir-btn" data-dir="left"><i
                                class="fas fa-arrow-left"></i></button>
                        <button onclick="addCommand('right')" class="dir-btn" data-dir="right"><i
                                class="fas fa-arrow-right"></i></button>
                    </div>
                    <div class="dir-row"><button onclick="addCommand('down')" class="dir-btn" data-dir="down"><i
                                class="fas fa-arrow-down"></i></button></div>
                    <!-- Action buttons -->
                    <div class="action-row">
                        <button onclick="startGame()" id="start-btn" data-i18n="start_game">Start</button>
                        <button onclick="resetGame()" data-i18n="reset">Reset</button>
                    </div>
                    <div class="action-row" style="justify-content:center;">
                        <button onclick="addFunctionCommand()" id="function-btn" style="display:none;">F1</button>
                    </div>
                    <div class="action-row" style="justify-content:center;">
                        <button onclick="addFunction2Command()" id="function2-btn" style="display:none;">F2</button>
                    </div>
                </div>
            </div>

            <!-- Function 1 Box -->
            <div id="function-box" style="display:none;">
                <div style="color:#ffaa00;font-weight:bold;margin-bottom:8px;">
                    <span data-i18n="function_f1">FUNCTION (F1):</span>
                    <button onclick="clearFunction()"
                        style="float:right;background:#cc0000;color:#fff;border:none;padding:4px 8px;font-size:12px;border-radius:6px;cursor:pointer;"
                        data-i18n="clear">Clear</button>
                </div>
                <div id="func-limit-text">
                    <span data-i18n="you_have_only">You have only</span> <span id="func-limit-number">4</span> <span
                        data-i18n="function_commands"> function commands</span>
                </div>

                <!-- Function 1 Commands -->
                <div id="function-commands"><span style="color:#666">[]</span></div>
                <div style="margin-top:8px;display:flex;justify-content:center;gap:6px;">
                    <button onclick="addToFunction('up')" class="dir-btn small" data-dir="up"><i
                            class="fas fa-arrow-up"></i></button>
                    <button onclick="addToFunction('down')" class="dir-btn small" data-dir="down"><i
                            class="fas fa-arrow-down"></i></button>
                    <button onclick="addToFunction('left')" class="dir-btn small" data-dir="left"><i
                            class="fas fa-arrow-left"></i></button>
                    <button onclick="addToFunction('right')" class="dir-btn small" data-dir="right"><i
                            class="fas fa-arrow-right"></i></button>
                    <button onclick="addToFunction('F2')" class="dir-btn small recursive-call-btn"
                        style="background:#ff6600; color:white; font-weight:bold;display:none;">
                        F2
                    </button>
                </div>
            </div>

            <!-- Function 2 Box -->
            <div id="function2-box" style="display:none;">
                <div style="color:#ffaa00;font-weight:bold;margin-bottom:8px;">
                    <span data-i18n="function_f2">FUNCTION 2 (F2):</span>
                    <button onclick="clearFunction2()"
                        style="float:right;background:#cc0000;color:#fff;border:none;padding:4px 8px;font-size:12px;border-radius:6px;cursor:pointer;"
                        data-i18n="clear">Clear</button>
                </div>
                <div id="func2-limit-text">
                    You have only <span id="func2-limit-number">4</span> <span data-i18n="function_commands"> function
                        commands</span>
                </div>

                <!--Function 2 Commands-->
                <div id="function2-commands"><span style="color:#666">[]</span></div>
                <div style="margin-top:8px;display:flex;justify-content:center;gap:6px;">
                    <button onclick="addToFunction2('up')" class="dir-btn small" data-dir="up"><i
                            class="fas fa-arrow-up"></i></button>
                    <button onclick="addToFunction2('down')" class="dir-btn small" data-dir="down"><i
                            class="fas fa-arrow-down"></i></button>
                    <button onclick="addToFunction2('left')" class="dir-btn small" data-dir="left"><i
                            class="fas fa-arrow-left"></i></button>
                    <button onclick="addToFunction2('right')" class="dir-btn small" data-dir="right"><i
                            class="fas fa-arrow-right"></i></button>
                    <button onclick="addToFunction2('F')" class="dir-btn small recursive-call-btn"
                        style="background:#ffaa00; color:white; font-weight:bold;display:none;">
                        F1
                    </button>
                </div>
            </div>
        </div>

        <!-- Command limit  -->
        <div id="command-limit-text" style="color:#ffaa00;font-weight:bold;margin:10px 0;display:none;">
            <span data-i18n="you_have_only">You have only</span> <span id="limit-number">4</span> <span
                data-i18n="main_commands"> main commands – use FUNCTION (F) wisely!</span>
        </div>
        <div id="command-list"></div>


        <!-- Phase Complete -->
        <div id="result-modal">
            <div class="result-wrapper">
                <div class="result-content">
                    <h3 id="result-title" data-i18n="phase_complete">Phase Complete!</h3>
                    <div id="result-message" style="font-size:1.3em; margin:20px 0; line-height:1.5;"></div>

                    <div class="result-buttons">
                        <button id="next-btn" onclick="nextPhase()" class="green-btn" data-i18n="next_phase">Next
                            Phase</button>
                        <button onclick="resetGame(); closeModal();" class="green-btn" data-i18n="play_again">Play
                            Again</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Button Ranking -->
        <div class="button-container">
            <button onclick="showRanking(currentPhase || 1)" class="green-btn">
                <span data-i18n="rankings">View Ranking</span> – <span data-i18n="phase">Phase</span> <span
                    id="ranking-phase-num">1</span>
            </button>
            <button onclick="showGlobalRankings()" class="green-btn" data-i18n="global_rankings">
                View Global Rankings
            </button>
        </div>

        <!-- Single phase results-->
        <div id="ranking-modal" class="modal" style="display:none;">
            <div class="modal-content">
                <span class="close" onclick="closeRankingModal()">×</span>
                <div class="scroll-area">
                    <h2 id="ranking-title" style="text-align:center; margin-top:0;">Phase 1 Ranking</h2>
                    <div id="ranking-list"></div>
                </div>
            </div>
        </div>

        <!-- Firebase -->
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

        <!-- Firebase Initialization (fake) -->
        <script type="module">
            let firebaseConfig = {
                apiKey: "fake-key-so-erro-nao-quebra",
                authDomain: "code-path-challenge.firebaseapp.com",
                projectId: "code-path-challenge",
                storageBucket: "code-path-challenge.firebasestorage.app",
                messagingSenderId: "6171949956",
                appId: "1:6171949956:web:111111111111111111111111",
                measurementId: "G-XXXXXXXXXX"
            };

            if (location.hostname === "localhost" || location.hostname === "127.0.0.1") {
                try {
                    const local = await import("./firebase-config.js");
                    firebaseConfig = local.firebaseConfig;
                    console.log("Config local carregado com sucesso!");
                } catch (e) {
                    console.warn("firebase-config.js não encontrado – normal se estiver hospedado");
                }
            }

            firebase.initializeApp(firebaseConfig);

            const db = firebase.firestore();
            const storage = firebase.storage();

            window.db = db;
            window.storage = storage;

            console.log("Firebase inicializado com sucesso!");
        </script>
        <script src="core.js"></script>
        <script src="phases.js"></script>
</body>

</html>